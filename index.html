<html>
<head>
  <meta charset="utf-8">
  <title>Assitant -- Your last assistant.</title>
  <link rel="stylesheet" href="app.css" type="text/css" media="screen" title="no title" charset="utf-8">
  <script>
    window.CodeMirror = require('codemirror');
  </script>
  <link rel="stylesheet" href="node_modules/codemirror/lib/codemirror.css">
  <script src="node_modules/codemirror/mode/javascript/javascript.js"></script>

</head>
    <body style="-webkit-app-region: drag">

        <div id="app">
          <div class="prompt">></div>
          <input id="userInput" type="text" placeholder="Type your commands here..." autofocus="true" oninput="debounce(input(this), 250)" onkeyup="keyed(event)">
          <span class="notification"></span>
        </div>
        <div class="conversation"></div>

        <script>
          function clear() {
            window.commandHistory.push('clear');
            window.commandHistoryIndex = window.commandHistory.length;
            window.myCodeMirror = undefined;
            document.getElementById('userInput').value = '';
            document.body.getElementsByClassName('conversation')[0].innerHTML = '';
          }

          // Returns a function, that, as long as it continues to be invoked, will not
          // be triggered. The function will be called after it stops being called for
          // N milliseconds. If `immediate` is passed, trigger the function on the
          // leading edge, instead of the trailing.
          function debounce(func, wait, immediate) {
            var timeout;
            return function() {
              var context = this, args = arguments;
              var later = function() {
                timeout = null;
                if (!immediate) func.apply(context, args);
              };
              var callNow = immediate && !timeout;
              clearTimeout(timeout);
              timeout = setTimeout(later, wait);
              if (callNow) func.apply(context, args);
            };
          };

          function keyed(event) {
            var userInput = document.getElementById('userInput').value;
            var func = /clear/;
            var match = func.exec(userInput);
            const ENTER = 13;
            if (match !== null && match[0] === 'clear' && event.keyCode == ENTER) {
              clear();
            }
          }
        </script>

        <script>
          require('./src/history')();
          var robot = require('./src/robot');
          function input(el) {
            robot(el.value);
          }
        </script>

    </body>
</html>
